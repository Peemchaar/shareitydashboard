import{q as A,o as w,c as b,w as o,k as O,e as a,i as q,a as _,b as e,g as c,I as P,t as Y,M as L,d as $}from"./index.ec32f494.js";import{c as f,a5 as H,a6 as I,O as W,a as z,a7 as S}from"./mdi.f693eecd.js";import{u as G,b as J,_ as K}from"./NavBar.59cebfca.js";import{_ as U}from"./CardBox.173aa79f.js";import{_ as d}from"./FormField.c48798ca.js";import{_ as m}from"./FormControl.280616cf.js";import{_ as Q}from"./FormFilePicker.184d08bb.js";import{_ as g}from"./BaseButton.674e3c10.js";import{_ as x}from"./BaseButtons.2d2440b4.js";import{a as X,_ as Z}from"./LayoutAuthenticated.0a6b42a9.js";import{_ as ee}from"./UserAvatar.fe9feea8.js";import{S as ae}from"./SectionTitleLineWithButton.85e6d937.js";import{U as oe}from"./UserController.5f62944b.js";import{S as V,u as se}from"./ServerCall.7354e88a.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./BaseIcon.dec28c75.js";import"./colors.dcae2bc6.js";import"./LoginController.9d60cd79.js";const le={__name:"UserAvatarCurrentUser",setup(n){const r=A();return(u,y)=>(w(),b(ee,{username:a(r).userName,avatar:a(r).userAvatar},{default:o(()=>[O(u.$slots,"default")]),_:3},8,["username","avatar"]))}},te={class:"space-y-3 text-center md:text-left lg:mx-12"},re=c("div",{class:"flex justify-center md:block"},null,-1),ne={class:"text-2xl"},ie=c("div",{class:"flex justify-center md:block"},null,-1),de={__name:"UserCard",setup(n){const r=A(),u=q(()=>r.userName);return _(!1),(y,v)=>(w(),b(U,null,{default:o(()=>[e(X,{type:"justify-around lg:justify-center"},{default:o(()=>[e(le,{class:"lg:mx-12"}),c("div",te,[re,c("h1",ne,[P(" Howdy, "),c("b",null,Y(u.value),1),P("! ")]),ie])]),_:1})]),_:1}))}},N={updateDataUser:async n=>{try{return(await V.post("/user/update/",{id:n.id,firstName:n.firstname,lastName:n.lastName,username:n.username,bio:n.bio,email:n.email,gender:n.gender})).data}catch(r){console.log(r)}},updatePassUser:async(n,r)=>{try{return(await V.post("/user/update-password/",{email:n,oldPassword:r.oldPassword,newPassword:r.newPassword})).data}catch(u){console.log(u)}},userAvatar:async n=>{try{let r=new FormData;r.append("file",n.file),r.append("id",n.id);const u=await V.post("/user/update-photo",r);return console.log("response",u),u}catch(r){console.log("error",r)}}},ue={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},me={class:"grid grid-cols-2 gap-2"},ce={class:"grid grid-cols-2 gap-2"},pe={class:"grid grid-cols-2 gap-2"},Te={__name:"ProfileView",setup(n){const r="https://chgsdev.shareity.com/",y=se().getUserNickname(),v=G();let l=_({}),h=_("");const k=_({}),i=_({}),T=q(()=>h.value&&h.value.match(/.*\..{2,5}/)?h.value:f);L(async()=>{const{id:p,firstName:s,lastName:t,email:R,username:M,rol:j,bio:B,imagen:E}=await oe.userAction(y);l.value={id:p,firstName:s,lastName:t,email:R,username:M,rol:j,bio:B},h.value=r+E});const F=()=>{N.updateDataUser(l.value).then(()=>{v.createAlert({title:"Data updated!",icon:"$success",text:"The data has been updated successfully!"})}),C()},C=async()=>{const p=l.id;await N.userAvatar({id:p,file:k.value})},D=()=>{try{const p=l.value.email;if(console.log("passwordForm",i.value),console.log("profileForm.value",l.value.email),i.value.oldPassword)N.updatePassUser(p,i.value).then(()=>{v.createAlert({title:"Data updated!",icon:"$success",text:"The data has been updated successfully!"})});else return v.createAlert({title:"Error!",icon:"$warning",text:"An error occurred while trying to update the data!"})}catch(p){console.log("error",p)}};return(p,s)=>(w(),b(Z,null,{default:o(()=>[e(K,null,{default:o(()=>[e(ae,{icon:T.value,title:"Profile",main:""},null,8,["icon"]),e(de,{class:"mb-6"}),c("div",ue,[e(U,{"is-form":"",onSubmit:$(F,["prevent"])},{footer:o(()=>[e(x,null,{default:o(()=>[e(g,{color:"info",type:"submit",label:"Submit",class:"mr-2",disabled:a(l).valid},null,8,["disabled"]),e(g,{color:"info",label:"Options",outline:""})]),_:1})]),default:o(()=>[e(d,{label:"Avatar",help:"Max 500kb"},{default:o(()=>[e(Q,{label:"Upload"})]),_:1}),c("div",me,[e(d,{label:"First Name",help:"Required. Your name"},{default:o(()=>[e(m,{modelValue:a(l).firstName,"onUpdate:modelValue":s[0]||(s[0]=t=>a(l).firstName=t),icon:a(f),name:"FirstName",required:"",autocomplete:"FirstName"},null,8,["modelValue","icon"])]),_:1}),e(d,{label:"Last Name",help:"Required. Your name"},{default:o(()=>[e(m,{modelValue:a(l).lastName,"onUpdate:modelValue":s[1]||(s[1]=t=>a(l).lastName=t),icon:a(f),name:"lastName",required:"",autocomplete:"lastName"},null,8,["modelValue","icon"])]),_:1})]),c("div",ce,[e(d,{label:"Phone",help:"This field can't be edited"},{default:o(()=>[e(m,{modelValue:a(l).phone,"onUpdate:modelValue":s[2]||(s[2]=t=>a(l).phone=t),icon:a(H),type:"phone",name:"phone",autocomplete:"Phone",disabled:""},null,8,["modelValue","icon"])]),_:1}),e(d,{label:"Rol User",help:"This field can't be edited"},{default:o(()=>[e(m,{modelValue:a(l).rol,"onUpdate:modelValue":s[3]||(s[3]=t=>a(l).rol=t),icon:a(I),type:"rol",name:"rol",autocomplete:"rol",disabled:""},null,8,["modelValue","icon"])]),_:1})]),c("div",pe,[e(d,{label:"E-mail",help:"This field can't be edited"},{default:o(()=>[e(m,{modelValue:a(l).email,"onUpdate:modelValue":s[4]||(s[4]=t=>a(l).email=t),icon:a(W),type:"email",name:"email",required:"",autocomplete:"email",disabled:""},null,8,["modelValue","icon"])]),_:1}),a(l).username===""?(w(),b(d,{key:0,label:"Username",help:"This field can't be edited"},{default:o(()=>[e(m,{modelValue:a(l).username,"onUpdate:modelValue":s[5]||(s[5]=t=>a(l).username=t),icon:a(f),type:"username",name:"username",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1})):(w(),b(d,{key:1,label:"Username",help:"This field can't be edited"},{default:o(()=>[e(m,{value:"This user does not have a username",icon:a(f),type:"username",name:"username",required:"",autocomplete:"username"},null,8,["icon"])]),_:1}))])]),_:1},8,["onSubmit"]),e(U,{"is-form":"",onSubmit:$(D,["prevent"])},{footer:o(()=>[e(x,null,{default:o(()=>[e(g,{type:"submit",color:"info",label:"Submit",class:"mr-2",disabled:i.value.newPassword!=i.value.password_confirmation},null,8,["disabled"]),e(g,{color:"info",label:"Options",outline:""})]),_:1})]),default:o(()=>[e(d,{label:"Current password",help:"Required. Your current password"},{default:o(()=>[e(m,{modelValue:i.value.oldPassword,"onUpdate:modelValue":s[6]||(s[6]=t=>i.value.oldPassword=t),icon:a(z),name:"oldPassword",type:"password",required:"",autocomplete:"current-password"},null,8,["modelValue","icon"])]),_:1}),e(J),e(d,{label:"New password",help:"Required. New password"},{default:o(()=>[e(m,{modelValue:i.value.newPassword,"onUpdate:modelValue":s[7]||(s[7]=t=>i.value.newPassword=t),icon:a(S),name:"newPassword",type:"password",required:"",autocomplete:"new-password"},null,8,["modelValue","icon"])]),_:1}),e(d,{label:"Confirm password",help:"Required. New password one more time"},{default:o(()=>[e(m,{modelValue:i.value.password_confirmation,"onUpdate:modelValue":s[8]||(s[8]=t=>i.value.password_confirmation=t),icon:a(S),name:"password_confirmation",type:"password",required:"",autocomplete:"new-password"},null,8,["modelValue","icon"])]),_:1})]),_:1},8,["onSubmit"])])]),_:1})]),_:1}))}};export{Te as default};
